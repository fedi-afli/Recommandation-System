version: '3.8'

services:
  # ----------------------------
  # 1. Backend Service (FastAPI)
  # ----------------------------
  backend:
    build: ./backend
    container_name: recommender_backend
    ports:
      - "8000:8000"
    volumes:
      - ./backend:/app  # Maps your local folder to container for live editing
    environment:
      - ALLOW_ORIGINS=http://localhost,http://localhost:3000

  # ----------------------------
  # 2. Frontend Service (React)
  # ----------------------------
  frontend:
    build: ./frontend
    container_name: recommender_frontend
    ports:
      - "80:80"        # Frontend will be available at http://localhost
    depends_on:
      - backend

  # ----------------------------
  # 3. Evaluation Service (Jupyter Lab)
  # ----------------------------
  evaluation:
    image: jupyter/scipy-notebook:latest  # Pre-made Data Science image
    container_name: recommender_evaluation
    ports:
      - "8888:8888"
    volumes:
      # Map 'evaluation' folder so you can save notebooks
      - ./evaluation:/home/jovyan/work/evaluation
      # Map 'backend' folder so you can IMPORT your backend code & READ csv
      - ./backend:/home/jovyan/work/backend
    environment:
      - JUPYTER_TOKEN=easytoken  # Sets a simple password for Jupyter
    command: start-notebook.py --NotebookApp.token='easytoken'